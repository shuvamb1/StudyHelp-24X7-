<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="styles.css">
    <title>StudyHelp 24x7</title>
	<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-B31J01CXSV"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-B31J01CXSV');
</script>
</head>
<body bgcolor="#e4e4ed">
    <header style="font-family:Gagalin">
        <div id="logo">üåê STUDYHELP 24X7</div>
	    <div class="auth-buttons" style="font-family:Gagalin">
            <button id="login" style="font-family:Gagalin;color:white">SIGN IN</button>
        </div>
    </header>
    <div class="fg1" style="font-family:Gagalin;">
        <div class="column">
		<div id="logf" style="text-align:left;padding:40px 40px;"><center>
		 <h1>Sign Up</h1></center>
    <form id="signupForm">
        <label for="name">Name:</label>
        <input type="text" id="name" name="Name" required>
<br><br>
        <label for="roll">Roll:</label>
        <input type="number" id="roll" name="Roll" required>
<br><br>
        <label for="department">Dept:</label>
        <select id="department" name="Dept" required>
            <option value="">Select Department</option>
            <option value="Computer Science">Computer Science</option>
            <option value="Electronics">Microbiology</option>
            <option value="Mechanical">Mathamatics</option>
            <option value="Civil">Statistics</option>
        </select>
<br><br>
        <label for="year">Year:</label>
        <select id="year" name="Year" required>
            <option value="">Select Year</option>
            <option value="1">1st Year</option>
            <option value="2">2nd Year</option>
            <option value="3">3rd Year</option>
            <option value="4">4th Year</option>
        </select>
<br><br>
        <label for="cin">CIN No:</label>
        <input type="text" id="cin" name="CIN_No" required>
<br><br><div id="regMessage" class="error">
<div style="float:right;height:20%;width:30%">
        <button id = 'submitBtn' type="submit" style="font-family:Gagalin;color:white;">Submit</button>
    </div><br></form>
        </div>
    </div>
	</div>
<script>
document.getElementById('login').addEventListener('click', function () {
  window.location.href = 'login.html';
});

document.getElementById('signupForm').addEventListener('submit', async function (e) {
  e.preventDefault();

  const messageDiv = document.getElementById('regMessage');
  const submitBtn = document.getElementById('submitBtn');
const loginBtn = document.getElementById('loginBtn');
	const loadingEl = document.getElementById('notice');
	let count = 0;
  const baseText = 'Loading';

  messageDiv.textContent = '';
  messageDiv.className = '';

  const data = {
    name: document.getElementById('name').value,
    roll: document.getElementById('roll').value,
    department: document.getElementById('department').value,
    year: document.getElementById('year').value,
    cin: document.getElementById('cin').value
  };
// ‚úÖ CIN pattern: 2y-400-4-02-05xx (y = 3‚Äì5, x = 0‚Äì9)
  const cinPattern = /^2[3-5]-400-4-02-05\d{2}$/;
  if (!cinPattern.test(cin)) {
    cinErrorDiv.textContent = "‚ùå INVALID CIN PATTERN . PLEASE ENTER A VALID CIN ID!!";
    return; // stop submission
  }
  try {
    const response = await fetch("https://studyhelp-backend-m4ff.onrender.com/register", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(data)
    });

    const msg = await response.text();

    if (!response.ok) {
      // ‚ùå Handle error without redirect
      messageDiv.textContent = msg;
      messageDiv.className = 'error';
    } else {
      // ‚úÖ On success: show message, hide button, redirect
      messageDiv.textContent = msg;
      messageDiv.className = 'success';
      submitBtn.style.display = 'none';
	    loginBtn.style.display = 'none';
	    const interval = setInterval(() => {
    count = (count + 1) % 4;  // cycle through 0 to 3
    loadingEl.textContent = baseText + '.'.repeat(count);
  }, 1000);

      setTimeout(() => {
        window.location.href = 'index1.html';
      }, 3000);
    }
  } catch (error) {
    console.error(error);
    messageDiv.textContent = "‚ùå Network error. Please try again.";
    messageDiv.className = 'error';
  }
});
	</script>
	<center id = "notice" style="color:white;font-size:1.4rem">IF YOU ALREADY REGISTERED BEFORE THEN GO TO SIGN IN</center>
</body>
</html>
